## UDP Multicast

### Broadcast vs Multicast

- 브로드캐스팅 방식은 네트워크에 속해있는 모든 노드에게 메세지를 전달해야 하기 때문에 비효율적. 네트워크에 속해있는 모든 노드가 커뮤니케이션을 원하는건 아닐 수 있음.
- 멀티 캐스트 방식은 **그룹 멤버쉽 기반으로 동작**하기 때문에 원하는 노드들에게만 메세지를 전달할 수 있다.

### Multicast 방식 구현

- IPv4 환경에서 D 클래스(224.0.0.0 ~ 239.255.255.255)에 속한 어떤 주소든지 멀티 캐스트 주소로 사용될 수 있다.
- 인터넷상의 라우터 대부분 Unicast 방식만을 지원. 멀티 캐스트 패킷 전송 위해서는 멀티 캐스트 라우터 사이에 터널링 개념을 사용하여 캡슐화된 패킷 전송 필요.
- Multicast 주소 가진 패킷 헤더 앞에 Multicast 라우터 간에 설정된 터널 양 끝단의 IP 주소 덧붙여서 라우팅.

### IGMP 프로토콜

멀티캐스팅을 가능하게 해주는 프로토콜이 존재하는데 인터넷 그룹 관리 프로토콜(IGMP)라는 것이다. IGMP는 여러 장치가 하나의 IP 주소를 공유하여 모두 동일한 데이터를 수신할 수 있도록 하는 프로토콜이다. 이때 IP 주소는 우리가 앞에서 알아본 D 클래스의 IP 주소가 될 것이다.

멀티 캐스팅 기능은 멀티 캐스팅을 수행해주는 라우터가 이 기능을 지원할 수 있어야 한다.  

- 멀티캐스팅에서 송신자는 유니캐스트 방식과 다르게 특정 호스트를 정해서 보내는 것이 아닌 멀티캐스트 IP 주소로 메세지를 보낸다. 그러면 메세지는 해당 IP를 공유하고 있는 멀티캐스트 그룹의 장치 모두에게 전파된다.
- IGMP 멀티캐스트 그룹은 언제나 변경될 수 있다. 장치는 언제든지 IGMP 그룹 가입이나 그룹 나가기 메세지를 전송할 수 있다.
- 인터넷 그룹 관리 프로토콜(IGMP) 기능이 포함된 라우터에서만 사용이 가능하다. 기본적으로 멀티 캐스트는 라우터에서 N개의 서버로 뿌려주는 방식을 사용하기 때문이다.

### 쿠버네티스 환경에서의 멀티캐스트

- 파드 간 멀티 캐스트 트래픽 기본적으로 **비활성화**
- 라우터 설정 & 쿠버네티스 설정 변경해야 사용 가능
- Kubernetes는 어떤 CNI를 사용하느냐에 따라 UDP Multicast를 지원하지 않을 수 있음

### 멀티 캐스트 사용 가능 영역

Multicast는 Kafka와 Redis Pub/Sub처럼 **다수의 컨슈머에게 메세지를 전파하는 용도**로 사용 가능. 토스증권에서는 시세 데이터
수신부에서 UDP Multicast를 사용 중

### Reference

- [https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-igmp/](https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-igmp/)